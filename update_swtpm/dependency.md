# Dependency Installation Record

Keep record of dependencies needed to install swtpm on oldest supported OS in this project - Ubuntu 18.04.

- :white_check_mark: compile newer version of swtpm directly from github
    - remove: every compiled need to be uninstalled first
    - :white_check_mark: (compile) [libtpms](https://github.com/stefanberger/libtpms/blob/master/INSTALL) (required by swtpm)
        - :white_check_mark: (compile) openssl (required by libtpms)
            - done with installing 1.1.1w
        - :white_check_mark: (compile) pkg-config (required by new environment breaking swtpm compiling)
            - `./configure --with-internal-glib`
            - `make -j$(nproc)`
            - `sudo make install`
    - :x: (apt-get) libtasn1-6-dev (required by swtpm)
    - :white_check_mark: (compile) libtasn1-4.19.0 (required by swtpm)
        - gnu_compile
    - :x: (apt-get) json-glib-1.0 (required by swtpm) # available version is old but still work
    - :white_check_mark: (comiple) json-glib
        - :white_check_mark: ninja
            - `sudo -H $path_to_new_py/pip3.12 install ninja`
        - :white_check_mark: meson
            - :white_check_mark: python > 3.7.0
                - https://www.python.org/downloads/source/
                - `wget https://www.python.org/ftp/python/3.12.4/Python-3.12.4.tgz`
                - `tar xf Python-3.12.4.tgz`
                - `sudo ./configure --prefix=$(pwd) --exec-prefix=$(pwd) --enable-shared` note `--enable-optimizations` increase performance but require long tests
                - `sudo make -j$(nproc)`
                - `sudo make -jj$(nproc) altinstall`
                - `sudo -H $path_to_new_py/pip3.12 install -U pip setuptools`
            - https://github.com/mesonbuild/meson/releases/tag/1.4.1
            - `sudo -H $path_to_new_py/pip3.12 install meson`
        - :white_check_mark: (compile) glib (required by json-glib)
            - :white_check_mark: (pip) packaging (required by glib)
                - `sudo -H $path_to_new_py/pip3.12 install packaging`
            - :white_check_mark: (compile) libpcre (required by glib)
                - ref: https://github.com/PCRE2Project/pcre2
                - `wget https://github.com/PCRE2Project/pcre2/releases/download/pcre2-10.44/pcre2-10.44.tar.gz`
                - `tar xf pcre2-10.44.tar.gz`
                - `./configure`
                - `make -j$(nproc)`
                - `sudo make install`
            - https://gitlab.gnome.org/GNOME/glib
            - https://download.gnome.org/sources/glib/
            - `wget https://download.gnome.org/sources/glib/2.80/glib-2.80.3.tar.xz`
            - `tar xf glib-2.80.3.tar.gz`
            - `$path_to_new_py/meson setup _build`
            - `$path_to_new_py/meson compile -C _build`
            - `sudo $path_to_new_py/meson install -C _build`
            - ERROR: doesn't work because pkgconfig file is not created
            - `sudo cp _build/meson-private/*.pc /usr/local/lib/pkgconfig`
        - `wget https://download.gnome.org/sources/json-glib/1.8/json-glib-1.8.0.tar.xz`
        - `tar xf json-glib-1.8.0.tar.xz`
        - `$path_to_new_py/meson setup _build` # this one would fall back for git cloning dependencies, but might fail, require retry
        - `$path_to_new_py/meson compile -C _build`
        - `sudo $path_to_new_py/meson install -C _build`
        - ERROR: doesn't work because pkgconfig file is not created
        - `sudo cp _build/meson-private/*.pc /usr/local/lib/pkgconfig`
    - :white_check_mark: (compile) [tpm2-tss](https://github.com/tpm2-software/tpm2-tss) (required by swtpm)
        - :white_check_mark: (compile) [json-c](https://github.com/json-c/json-c/tree/master) (required by tpm2-tss)
        - :white_check_mark: (compile) libcurl (required by tpm2-tss)
            - `wget https://curl.se/download/curl-8.8.0.tar.gz`
            - `tar xf curl-8.8.0.tar.gz`
            - `./configure --with-openssl`
            - `make -j$(nproc)`
            - `sudo make install`
        - :x: (compile) uuid (required by tpm2-tss)
            - https://sourceforge.net/projects/libuuid/files/
            - `wget https://sourceforge.net/projects/libuuid/files/libuuid-1.0.3.tar.gz/download`
            - `tar xf libuuid-1.0.3.tar.gz`
            - `./configure`
            - `make -j$(nproc)`
            - `sudo make install`
            - compiled version way too old, break wget
        - :white_check_mark: (compile) util-linux (containing libuuid/uuid)
            - :white_check_mark: (compile) gettext (containing autopoint)
                - http://ftp.twaren.net/Unix/GNU/gnu/gettext/
                - `wget ftp://ftp.twaren.net/Unix/GNU/gnu/gettext/gettext-0.22.tar.gz`
                - `tar xf gettext-0.22.tar.gz`
                - `./configure`
                - `make -j$(nproc)`
                - `make install`
            - :white_check_mark: (compile) flex (required by util-linux)
                - https://github.com/westes/flex
                - `wget https://github.com/westes/flex/releases/download/v2.6.3/flex-2.6.3.tar.gz`
                - `tar xf flex-2.6.3.tar.gz`
                - `./configure`
                - `make -j$(nproc)`
                - `make install`
                - note: 2.6.4 causing core dump when compiling
            - https://github.com/util-linux/util-linux/tags
            - `wget https://github.com/util-linux/util-linux/archive/refs/tags/v2.40.1.tar.gz`
            - `tar xf v2.40.1.tar.gz`
            - `./autogen.sh`
            - `./configure --disable-all-programs --enable-libuuid`
            - `make -j$(nproc)`
            - `sudo make install`
            - autogen.sh script will caused aclocal error, caused by automake 1.16.0
            - also, it's not recommended to install entire util-linux, might break system since its core utilities
    - :white_check_mark: (compile) [gmp](https://gmplib.org/devel/repo-usage) (required by swtpm)
        - :white_check_mark: (apt-get) mercurial (required by libgmp-dev)
        - :white_check_mark: (compile) texinfo (required by gmp)
            - :white_check_mark: (compile) [automake](https://github.com/autotools-mirror/automake) (new version required by texinfo)
                - :white_check_mark: (compile) [autoconf](https://github.com/autotools-mirror/autoconf) (required by new automake)
                    - :grey_question: (apt-get) ftp
                    - :white_check_mark: (compile) help2man (required by autoconf)
                        - ref: https://www.gnu.org/software/help2man/
                        - ref: http://ftp.twaren.net/Unix/GNU/gnu/help2man/
                        - `wget ftp://ftp.twaren.net/Unix/GNU/gnu/help2man/help2man-1.49.3.tar.xz`
                        - `tar xf help2man-1.49.3.tar.xz`
                        - `./configure`
                        - `make`
                        - `sudo make install`
                    - `./bootstrap`
                    - `./configure`
                    - `make -j$(nproc)`
                    - `sudo make install`
                - :white_check_mark: (compile) m4 (required by new automake)
                    - :white_check_mark: (compile) gperf (required by m4)
                        - ref: https://www.gnu.org/software/gperf/
                        - ref: http://ftp.twaren.net/Unix/GNU/gnu/gperf/
                        - `wget ftp://ftp.twaren.net/Unix/GNU/gnu/gperf/gperf-3.1.tar.gz`
                        - `tar xf gperf-3.1.tar.gz`
                        - `./configure`
                        - `make`
                        - `sudo make install`
                    - ref: http://ftp.twaren.net/Unix/GNU/gnu/m4/
                    - `wget ftp://ftp.twaren.net/Unix/GNU/gnu/m4/m4-latest.tar.xz`
                    - `tar xf m4-latest.tar.xz`
                    - `./configure`
                    - `make -j$(nproc)`
                    - `sudo make install`
        - :white_check_mark: (compile) [libtool](https://github.com/autotools-mirror/libtool) (required by gmp)
            - `./bootstrap`
            - `./configure`
            - `make -j$(nproc)`
            - `sudo make install`
        -  `hg clone https://gmplib.org/repo/gmp/ gmp`
        - `./.bootstrap`
        - `./configure`
        - `make -j$(nproc)`
        - `sudo make install`
    - :grey_question: (compile) gnutls (required by swtpm)
        - :x: (apt-get) unbound-anchor (required by gnutls) can't create root.key
        - :grey_question: (compile) libnettle (required by gnutls, require gmp)
        - http://ftp.twaren.net/Unix/GNU/gnu/nettle/
            - `wget ftp://ftp.twaren.net/Unix/GNU/gnu/nettle/nettle-3.10.tar.gz`
            - `tar xf nettle-3.10.tar.gz`
            - `./configure`
            - `make -j$(nproc)`
            - `make install`
        - :x: (compile) gnulib (required by gnutls)
            - https://github.com/coreutils/gnulib/tags
            - `wget https://github.com/coreutils/gnulib/archive/refs/tags/v1.0.tar.gz`
            - `tar xf v1.0.tar.gz`
            - activate python virtualenv py3
            - `./gnulib-tool --create-testdir --with-tests --dir=../gnulib-build`
            - `cd ../gnulib-build`
            - `./configure`
            - `make dist`
        - :white_check_mark: (compile) gettext (required by gnutls)
            - http://ftp.twaren.net/Unix/GNU/gnu/gettext/
            - `wget ftp://ftp.twaren.net/Unix/GNU/gnu/gettext/gettext-0.22.tar.gz`
            - `tar xf gettext-0.22.tar.gz`
            - `./configure`
            - `make -j$(nproc)`
            - `make install`
        - [ ] (compile) gtk-doc (required by gnutls, can be before libtasn1, also can not)
            - :white_check_mark: (compile) libxslt (required by gtk-doc)
                - :white_check_mark: (compile) python2.7 (required by libxslt)
                    - https://www.python.org/downloads/source/
                    - `wget https://www.python.org/ftp/python/2.7.18/Python-2.7.18.tgz`
                    - `./configure --prefix=$(pwd) --exec-prefix=$(pwd) --enable-shared` note `--enable-optimizations` increase performance but require long tests
                    - `sudo make -j$(nproc)`
                    - `sudo make altinstall`
                    - `pc_files=($(find . -name '*.pc'))`
                    - `cd $(dirname ${pc_files[0]})`
                    - `sudo cp $(basename ${files[0]}) /usr/local/lib/pkgconfig`
                    - remove: `python-2.7.pc` `libffi.pc` `python.pc`
                - :x: (apt-get) python2.7-dev libpython2.7-dev
                - :white_check_mark: (compile) libxml (required by libxslt, requries python2.7)
                    - https://gitlab.gnome.org/GNOME/libxml2/-/releases
                    - `wget https://gitlab.gnome.org/GNOME/libxml2/-/archive/v2.13.1/libxml2-v2.13.1.tar.gz`
                    - `tar xf libxml2-v2.13.1.tar.gz`
                    - `./autogen.sh`
                    - `make`
                    - `make install`
                - https://gitlab.gnome.org/GNOME/libxslt/-/releases
                - `wget https://gitlab.gnome.org/GNOME/libxslt/-/archive/v1.1.41/libxslt-v1.1.41.tar.gz`
                - `tar xf libxslt-v1.1.41.tar.gz`
                - `./autogen.sh`
                - `make`
                - `make install`
            - [ ] (compile) dblatex (required by gtk-doc), libxml2 problem?, requires libxslt
                - :grey_question: (compile) xslt with saxon (required by dblatex)
                    - binary is generated, but no pc file
                - :grey_question: (compile) epstopdf (required by dblatex)
                - :grey_question: (compile) fig2dev (required by dblatex)
                - [ ] (compile) texlive (required by dblatex)
                    - :white_check_mark: (compile) libX11 (required by texlive)
                        - :white_check_mark: (compile) macros-util-macros (required by libX11)
                            - https://gitlab.freedesktop.org/xorg/util/macros/-/tags
                            - `wget https://gitlab.freedesktop.org/xorg/util/macros/-/archive/util-macros-1.20.1/macros-util-macros-1.20.1.tar.gz`
                            - `./autogen.sh`
                            - `make`
                            - `sudo make install`
                        - :white_check_mark: (compile) libXtrans (required by libX11)
                            - https://gitlab.freedesktop.org/xorg/lib/libxtrans/-/tags
                            - `wget https://gitlab.freedesktop.org/xorg/lib/libxtrans/-/archive/xtrans-1.5.0/libxtrans-xtrans-1.5.0.tar.gz`
                            - `tar xf libxtrans-xtrans-1.5.0.tar.gz`
                            - `./autogen.sh`
                            - `make`
                            - `sudo make install`
                        - :white_check_mark: (compile) xproto (required by libX11)
                            - https://gitlab.freedesktop.org/xorg/proto/xproto/-/tags
                            - `wget https://gitlab.freedesktop.org/xorg/proto/xproto/-/archive/xproto-7.0.31/xproto-xproto-7.0.31.tar.gz`
                            - `tar xf xproto....tar.gz`
                            - `./autogen.sh`
                            - `make`
                            - `sudo make install`
                        - :white_check_mark: (compile) xextproto (required by libX11)
                            - https://gitlab.freedesktop.org/xorg/proto/xextproto/-/tags
                            - `wget https://gitlab.freedesktop.org/xorg/proto/xextproto/-/archive/xextproto-7.3.0/xextproto-xextproto-7.3.0.tar.gz`
                            - `tar xf xextproto....tar.gz`
                            - `./autogen.sh`
                            - `make`
                            - `sudo make install`
                        - :white_check_mark: (compile) libXcb (required by libX11)
                            - :white_check_mark: (compile) xcb-proto (required by libX11)
                                - https://gitlab.freedesktop.org/xorg/proto/xcbproto/-/tags
                                - `wget https://gitlab.freedesktop.org/xorg/proto/xcbproto/-/archive/xcb-proto-1.17.0/xcbproto-xcb-proto-1.17.0.tar.gz`
                                - `tar xf xcbproto....tar.gz`
                                - `./autogen.sh`
                                - `make`
                                - `sudo make install`
                            - :white_check_mark: (compile) xau (required by libX11)
                                - https://gitlab.freedesktop.org/xorg/lib/libxau/-/tags
                                - `wget https://gitlab.freedesktop.org/xorg/lib/libxau/-/archive/libXau-1.0.11/libxau-libXau-1.0.11.tar.gz`
                                - `tar xf libxau....tar.gz`
                                - `./autogen.sh`
                                - `make`
                                - `sudo make install`
                            - https://gitlab.freedesktop.org/xorg/lib/libxcb/-/tags
                            - `wget https://gitlab.freedesktop.org/xorg/lib/libxcb/-/archive/libxcb-1.17.0/libxcb-libxcb-1.17.0.tar.gz`
                            - `tar xf libxcb....tar.gz`
                            - `./autogen.sh`
                            - `make`
                        - :white_check_mark: (compile) kbproto (required by libX11)
                            - https://gitlab.freedesktop.org/xorg/proto/kbproto/-/tags
                            - `wget https://gitlab.freedesktop.org/xorg/proto/kbproto/-/archive/kbproto-1.0.7/kbproto-kbproto-1.0.7.tar.gz`
                            - `tar xf kbproto....tar.gz`
                            - `./autogen.sh`
                            - `make`
                            - `sudo make install`
                        - :white_check_mark: (compile) inputproto (required by libX11)
                            - https://gitlab.freedesktop.org/xorg/proto/inputproto/-/tags
                            - `wget https://gitlab.freedesktop.org/xorg/proto/inputproto/-/archive/inputproto-2.3.2/inputproto-inputproto-2.3.2.tar.gz`
                            - `tar xf inputproto....tar.gz`
                            - `./autogen.sh`
                            - `make`
                            - `sudo make install`
                        - :white_check_mark: (compile) libXaw (required by libX11)
                            - [ ] (compile) xserver/xext (required by libXaw)
                                - https://gitlab.freedesktop.org/xorg/xserver/-/tags
                                - `wget https://gitlab.freedesktop.org/xorg/xserver/-/archive/xwayland-24.1.0/xserver-xwayland-24.1.0.tar.gz`
                                - `tar xf xserver....tar.gz`
                                - source python3.x build environment
                            - [ ] (compile) xt (required by libXaw)
                            - [ ] (compile) xmu (required by libXaw)
                            - https://gitlab.freedesktop.org/xorg/lib/libxaw/-/tags
                            - `wget https://gitlab.freedesktop.org/xorg/lib/libxaw/-/archive/libXaw-1.0.16/libxaw-libXaw-1.0.16.tar.gz`
                            - `tar xf libxaw....tar.gz`
                            - `./autogen.sh`
                            - `make`
                            - `sudo make install`
                        - https://github.com/mirror/libX11/tags
                        - `wget https://github.com/mirror/libX11/archive/refs/tags/libX11-1.8.4.tar.gz`
                        - `tar xf libX11....tar.gz`
                        - `./autogen.sh`
                        - `make`
                        - `sudo make install`
                    - https://github.com/TeX-Live/texlive-source/releases
                    - `wget https://github.com/TeX-Live/texlive-source/archive/refs/tags/svn70897.tar.gz`
                    - `tar xf svn70897.tar.gz`
                    - `./configure --enable-build-in-source-tree`
                    - `make`
                - [ ] (compile) makeindex (required by dblatex)
                - [ ] (compile) kpsewhich (required by dblatex)
                - https://sourceforge.net/projects/dblatex/files/dblatex/
                - `wget https://sourceforge.net/projects/dblatex/files/dblatex/dblatex-0.3.12/dblatex3-0.3.12.tar.bz2/download`
                - `tar xf dblatex3-0.3.12.tar.bz2`
                - `python setup.py build`
                - `sudo python setup.py install`
            - https://gitlab.gnome.org/GNOME/gtk-doc/-/tags
            - note: no need to source virtualenv, it only requires 3.x not > 3.7
            - `wget https://gitlab.gnome.org/GNOME/gtk-doc/-/archive/1.34.0/gtk-doc-1.34.0.tar.gz`
            - `tar xf gtk-doc-1.34.0.tar.gz`
            - `./configure`
        - gnu website version is too old, new version requires a lot of dependencies
        - install a lot of libraries, maybe should be the first few to install?
        - https://gitlab.com/gnutls/gnutls
        - `wget https://gitlab.com/gnutls/gnutls/-/archive/3.7.11/gnutls-3.7.11.tar.gz`
        - `./configure`
        - `make -j$(nproc)`
    - :grey_question: (compile) autogen (required by new automake)
        - :white_check_mark: (compile) guile (required by autogen)
            - :white_check_mark: (compile) libunistring (required by guile)
                - ref: http://ftp.twaren.net/Unix/GNU/gnu/libunistring/
                - `wget ftp://ftp.twaren.net/Unix/GNU/gnu/libunistring/libunistring-1.2.tar.xz`
                - `tar xf libunistring-1.2.tar.xz`
                - `./configure`
                - `make -j$(nproc)`
                - `sudo make install`
            - [ ] (compile) libffi (required by guile)
                - ref: https://github.com/libffi/libffi 
                - `wget https://github.com/libffi/libffi/releases/download/v3.4.6/libffi-3.4.6.tar.gz`
                - `tar xf libffi-3.4.6.tar.gz`
                - `./configure`
                - `make -j$(nproc)`
            - ref: http://ftp.twaren.net/Unix/GNU/gnu/guile/
            - `wget ftp://ftp.twaren.net/Unix/GNU/gnu/guile/guile-3.0.9.tar.xz`
            - `tar xf guile-3.0.9.tar.xz`
            - ./configure
        - ref: http://ftp.twaren.net/Unix/GNU/gnu/autogen/
        - `wget ftp://ftp.twaren.net/Unix/GNU/gnu/autogen/rel5.18.16/autogen-5.18.16.tar.xz`
        - `tar xf autogen-5.18.16.tar.xz`
        - `./configure`
        - `make -j$(nproc)`
        - `sudo make install`
